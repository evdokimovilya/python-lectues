## Django. Фильтрация. Связь таблиц. GET запросы

Прежде чем читать эту лекцию, ознакомьтесь[ с лекцией про GET запросы](https://pythontop.streamlit.app/%D0%92%D0%B5%D0%B1._GET_%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81._%D0%9F%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B). 

Многие сайты обладают механизмом фильтрации данных на своих страницах. 
- фильтр категорий книг
- фильтр типа товаров
- фильтр по цене

Чаще всего этот механизм реализуется через параметры GET запроса. 

Реализуем в нашем приложении механизм фильтрации книг по категориям. 

### Добавление таблицы с категориями

Добавьте новую таблицу для хранений категорий книг. Это поможет в дальнейшем легко управлять ими, добавлять и удалять. 

Для того, чтобы была возможность связать таблицы категорий и книг, в таблице с книгами также необходимо добавить новое поле. 

![фвыа](http://images.na4u.ru/static/django4/1.png)

Примените миграции 

```
python manage.py makemigrations 
python manage.py migrate
```

Добавьте в админку новую таблицу 

![фвыа](http://images.na4u.ru/static/django4/2.png)

Добавьте данные 

![фвыа](http://images.na4u.ru/static/django4/3.png)
Привяжите категории к книгам, отредактировав их 

![фвыа](http://images.na4u.ru/static/django4/4.png)

В шаблоне добавьте отображение категории 

![фвыа](http://images.na4u.ru/static/django4/5.png)


В итоге у вас должен получиться список книг с дополнительным отображением категорий

![фвыа](http://images.na4u.ru/static/django4/6.png)
## Вывод таблицы с категориями 

Для того, чтобы можно было в дальнейшем фильтровать данные по категориям необходимо вывести их на страницу. 

Для этого надо внутри представления получить все категории из базы и передать их в контекст. 

![фвыа](http://images.na4u.ru/static/django4/7.png)

Отредактируйте шаблон, добавив туда отображение категорий

![фвыа](http://images.na4u.ru/static/django4/11.png)


![фвыа](http://images.na4u.ru/static/django4/12.png)
## Фильтрация по категориям

Итак, остался последний шаг - сделать так, чтобы при клике на каждую категорию, список книг менялся. 

Для этого нужно, чтобы ссылка каждой категории обладала дополнительным гет-параметром. Назовем его category_id. В качестве значения этого параметры будем подставлять id. 

При клике на ссылку будет отправляться запрос с параметром. На сервере мы сможем написать логику, которая будет читать дополнительные параметры. И если есть - дополнительно фильтровать данные. 
![фвыа](http://images.na4u.ru/static/django4/15.png)

В блок вывода категорий в атрибут href добавьте выражение, которое будет подставлять разные id категорий. 

![фвыа](http://images.na4u.ru/static/django4/8.png)


Проверьте, что при клике на категорию в адресной строке отображается url с параметром 

![фвыа](http://images.na4u.ru/static/django4/10.png)
Осталось добавить логику фильтрации внутрь представления 

1. Получите параметр, обратившись к объекту request.GET
2. Добавьте условный оператор, который при найденном параметре, будет вызывать дополнительный метод filter 

Обратите внимание, что внутри метода filter мы написали **category__id** - здесь используется двойной знак подчеркивания. Он используется в том случае, если вы обращается к полю, которое связано с другой таблицей. 

![фвыа](http://images.na4u.ru/static/django4/14.png)

В результате клик по категории теперь должен менять содержимое страницы 

![фвыа](http://images.na4u.ru/static/django4/13.png)