## Django 2. Работа с базой данных.

Любое серьезное веб приложение должно взаимодействовать с базой данных. В джанго из коробки заложена возможность легко взаимодействовать с наиболее популярными СУБД

SQLite, PostgreSQL, MSSQLI и другие 

Настройки для базы данных хранятся в файле settings.py. По умолчанию используется sqlite, поэтому ничего менять не будем. 

### Cоздание таблиц (моделей)

Джанго позволяет взаимодействовать с базой с помощью ORM. То есть для того, чтобы выполнить любую операцию с базой достаточно обратиться к классу, который представляет собой модель реальной таблицы в БД. 

Прежде, выполнять запросы, надо создать модель таблицы и добиться того, чтобы она создалась в базе 

Для этого: 

1. Зайдите в файл models.py 
2. Cоздайте класс, описывающий таблицу с книгами. 
	1. Поля
		1. Автор
		2. Название книги
		3. Цена 

![фвыа](http://images.na4u.ru/static/django1/24.png)

![фвыа](http://images.na4u.ru/static/django1/25.png)

После создания класса, надо выполнить специальные команды. 

#### Cоздание и применение миграций

Само по себе создания класса-таблицы еще не приводит к изменениям в базе. Для это в джанго существует механизм создания и применения миграций. 

Миграция - это файл, в котором в структурированном виде описываются изменения, которые вы делаете с классами в models.py. Любое изменение надо фиксировать с помощью этой команды - тем самым создать миграцию. 

Файл с миграцией должен быть применен, после этого произойдут изменения в самой базе. 

**Команда для создания миграций** 

```
python manage.py makemigrations 
```

**Команда для применения миграций** 

```
python manage.py migrate 
```

Со временем у вас накапливается определенное количество файлов миграций, что является нормальной практикой.  Это сделано для того, чтобы история изменения базы данных всегда была доступна. Тогда любой человек может воссоздать такую же структуру базы у себя. Если вы добавите новое поле в таблицу и создадите файл с миграцией - ваш товарищ легко сможет воспроизвести у себя это же изменения, применив миграции. 


1. После того, как вы создали таблицу Books, выполните команду  создания миграций

![фвыа](http://images.na4u.ru/static/django2/1.png)

2. Затем примените миграции 

![фвыа](http://images.na4u.ru/static/django2/2.png)
#### Регистрация моделей таблиц в админке

Джанго из коробки содержит удобную админ панель, в которой можно взаимодействовать с таблицами из базы. 

Чтобы таблицу можно было увидеть в админ панели надо указать это в файле admin.py вашего приложения 

![фвыа](http://images.na4u.ru/static/django2/4.png)
#### Создание суперпользователя для входа в админку

Админ панель находится по адресу
При условии, что ваш проект запускается по такому же порту 8000

```
127.0.0.1:8000/admin
```

Для входа в админ панель нужно указать логин и пароль. 
Для этого введите команду 

```
python manage.py createsuperuser
```

![фвыа](http://images.na4u.ru/static/django2/3.png)
1. Введите логин
2. Email можно пропустить
3. Введите пароль и повтор пароля. Обратите внимание, что в целях безопасности текст пароля отображаться не будет 
4. Джанго может спросить вам, оставлять ли пароль, если он слишком простой. В таком случае введите "Y"

Попробуйте войти в админ панель с помощью созданной пары логин-пароль 
![фвыа](http://images.na4u.ru/static/django2/5.png)

Перейдите в таблицу с книгами. Создайте новую запись. 

![фвыа](http://images.na4u.ru/static/django2/6.png)
![фвыа](http://images.na4u.ru/static/django2/7.png)


Введите данные и нажмите "Save"

![фвыа](http://images.na4u.ru/static/django2/8.png)

Запись должна появиться в общем списке 

![фвыа](http://images.na4u.ru/static/django2/9.png)




Можете добавить еще одну запись 
![фвыа](http://images.na4u.ru/static/django2/10.png)






После этого можно приступать к выводу информации из базы данных. Это будет в следующей главе. 